<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GeoFS Private Offline</title>
  <style>
    html, body, #cesiumContainer {
      margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>

  <script>
    // Register the service worker from sw.js in the same directory
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker registered.'))
        .catch(console.error);
    } else {
      console.warn('Service workers not supported.');
    }
  </script>

  <script>
    // Load GeoFS scripts sequentially after page load (requests intercepted by service worker)
    window.addEventListener('load', () => {
      function loadScript(src) {
        return new Promise((res, rej) => {
          const s = document.createElement('script');
          s.src = src;
          s.onload = res;
          s.onerror = rej;
          document.head.appendChild(s);
        });
      }

      (async () => {
        try {
          await loadScript('https://www.geo-fs.com/js/Cesium/build/Cesium.js');
          window.CESIUM_BASE_URL = 'https://www.geo-fs.com/js/Cesium/build/';
          await loadScript('https://www.geo-fs.com/js/commonJS.js');
          await loadScript('https://www.geo-fs.com/js/geofs.js');
          await loadScript('https://www.geo-fs.com/js/loader.js');

          if (window.geofs && geofs.init) {
            geofs.init({
              containerId: 'cesiumContainer',
              assetsBaseUrl: 'https://www.geo-fs.com/',
              multiplayerServerUrl: null,  // disables public multiplayer servers
              maxPlayers: 1  // only 1 person (you)
            });
          }
        } catch (e) {
          console.error('Error loading GeoFS scripts:', e);
        }
      })();
    });
  </script>
</body>
</html>
